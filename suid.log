Script started on 2018-07-27 12:28:48+0300
root@root:/tmp/setuid-test# cp `which vi` .
root@root:/tmp/setuid-test# echo 123 > files
root@root:/tmp/setuid-test# ls -l files
-rw-r--r-- 1 root root 4 Jul 27 12:28 files
root@root:/tmp/setuid-test# chow[Km[K[Kmod o-rwx ./files 
root@root:/tmp/setuid-test# ls -l
total 2464
-rw-r----- 1 root root       4 Jul 27 12:28 files
-rw-r--r-- 1 root root       0 Jul 27 12:28 shell-suid
-rw-r--r-- 1 root root       0 Jul 27 12:28 time-suid
-rwxr-xr-x 1 root root 2518768 Jul 27 12:28 [0m[01;32mvi[0m
root@root:/tmp/setuid-test# su user
[01;32muser@root[00m:[01;34m/tmp/setuid-test[00m$ ./vi ./files 
[?1049h[?1h=[1;36r[34l[34h[?25h[23m[24m[0m[H[J[?25l[36;1H"./files" [Permission Denied][2;1H[94m~                                                                   [3;1H~                                                                   [4;1H~                                                                   [5;1H~                                                                   [6;1H~                                                                   [7;1H~                                                                   [8;1H~                                                                   [9;1H~                                                                   [10;1H~                                                                   [11;1H~                                                                   [12;1H~                                                                   [13;1H~                                                                   [14;1H~                                                                   [15;1H~                                                                   [16;1H~                                                                   [17;1H~                                                                   [18;1H~                                                                   [19;1H~                                                                   [20;1H~                                                                   [21;1H~                                                                   [22;1H~                                                                   [23;1H~                                                                   [24;1H~                                                                   [25;1H~                                                                   [26;1H~                                                                   [27;1H~                                                                   [28;1H~                                                                   [29;1H~                                                                   [30;1H~                                                                   [31;1H~                                                                   [32;1H~                                                                   [33;1H~                                                                   [34;1H~                                                                   [35;1H~                                                                   [0m[36;51H0,0-1[9CAll[1;1H[34h[?25h[?25l[36;41H:[1;1H[36;1H[K[36;1H:[34h[?25h![?25l[34h[?25h[?25l[36;2H[K[36;2H[34h[?25hq[?25l[34h[?25h![?25l[34h[?25h[?25l[36;1H[K[36;1H[?1l>[34h[?25h[?1049l[01;32muser@root[00m:[01;34m/tmp/setuid-test[00m$ exit
exit
root@root:/tmp/setuid-test# chmod u+s ./vi 
root@root:/tmp/setuid-test# su user
[01;32muser@root[00m:[01;34m/tmp/setuid-test[00m$ ./vi ./files 
[?1049h[?1h=[1;36r[34l[34h[?25h[23m[24m[0m[H[J[?25l[36;1H"./files" [readonly] 1L, 4C[1;1H123
[94m~                                                                   [3;1H~                                                                   [4;1H~                                                                   [5;1H~                                                                   [6;1H~                                                                   [7;1H~                                                                   [8;1H~                                                                   [9;1H~                                                                   [10;1H~                                                                   [11;1H~                                                                   [12;1H~                                                                   [13;1H~                                                                   [14;1H~                                                                   [15;1H~                                                                   [16;1H~                                                                   [17;1H~                                                                   [18;1H~                                                                   [19;1H~                                                                   [20;1H~                                                                   [21;1H~                                                                   [22;1H~                                                                   [23;1H~                                                                   [24;1H~                                                                   [25;1H~                                                                   [26;1H~                                                                   [27;1H~                                                                   [28;1H~                                                                   [29;1H~                                                                   [30;1H~                                                                   [31;1H~                                                                   [32;1H~                                                                   [33;1H~                                                                   [34;1H~                                                                   [35;1H~                                                                   [0m[36;51H1,3[11CAll[1;3H[34h[?25h[?25l[36;41H:[1;3H[36;1H[K[36;1H:[34h[?25he[?25l[34h[?25h[?25l [34h[?25h/[?25l[34h[?25he[?25l[34h[?25ht[?25l[34h[?25hc[?25l[34h[?25h/[?25l[34h[?25hs[?25l[34h[?25hh[?25l[34h[?25ha[?25l[34h[?25hd[?25l[34h[?25ho[?25l[34h[?25hw[?25l[34h[?25h[?25l"/etc/shadow" [readonly] 50L, 1524C[1;1H[36mroot[0m:[35m![0m:[31m17374[0m:[31m0[0m:[34m99999[0m:7:::
[36mdaemon[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[2;28H[K[3;1H[36mbin[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[3;25H[K[4;1H[36msys[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[4;25H[K[5;1H[36msync[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[5;26H[K[6;1H[36mgames[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[6;27H[K[7;1H[36mman[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[7;25H[K[8;1H[36mlp[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[8;24H[K[9;1H[36mmail[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[9;26H[K[10;1H[36mnews[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[10;26H[K[11;1H[36muucp[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[11;26H[K[12;1H[36mproxy[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[12;27H[K[13;1H[36mwww-data[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[13;30H[K[14;1H[36mbackup[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[14;28H[K[15;1H[36mlist[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[15;26H[K[16;1H[36mirc[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[16;25H[K[17;1H[36mgnats[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[17;27H[K[18;1H[36mnobody[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[18;28H[K[19;1H[36msystemd-timesync[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[19;38H[K[20;1H[36msystemd-network[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[20;37H[K[21;1H[36msystemd-resolve[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[21;37H[K[22;1H[36msystemd-bus-proxy[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[22;39H[K[23;1H[36msyslog[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[23;28H[K[24;1H[36m_apt[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[24;26H[K[25;1H[36mmessagebus[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[25;32H[K[26;1H[36musermetrics[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[26;33H[K[27;1H[36muuidd[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[27;27H[K[28;1H[36mrtkit[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[28;27H[K[29;1H[36mavahi-autoipd[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[29;35H[K[30;1H[36musbmux[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[30;28H[K[31;1H[36mlightdm[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[31;29H[K[32;1H[36mwhoopsie[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[32;30H[K[33;1H[36mgeoclue[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[33;29H[K[34;1H[36mkernoops[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[34;30H[K[35;1H[36mspeech-dispatcher[0m:[35m![0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[35;39H[K[36;51H4,1[11CTop[4;1H[34h[?25h[?25l[36;41Hi[4;1H[36;41H [4;1H[36;1H[1m-- INSERT --[0m[36;13H[K[36;51H4,1[11CTop[36;14H[31mW10: Warning: Changing a readonly file[0m[36;52H[K[36;1H
[32mPress ENTER or type command to continue[34h[?25h[0m[1;1H[L[?25l[1;1H[36mroot[0m:[35m![0m:[31m17374[0m:[31m0[0m:[34m99999[0m:7:::[36;14H[K[36;51H3,1[11CTop[3;1H[34h[?25h[?25l[36;51H4[4;1H[34h[?25h[?25l[36;51H3[3;1H[34h[?25h[?25l[36;51H2[2;1H[34h[?25h[?25l[36;51H1[1;1H[34h[?25h[?25l[36;51H2[2;1H[34h[?25h[?25l[3;35r[3;1H[L[1;36r[2;1H[K[3;1H[36mdaemon[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[36;51H[K[36;51H3,1[11CTop[3;1H[34h[?25h[?25l[4;35r[4;1H[L[1;36r[3;1H[K[4;1H[36mdaemon[0m:[35m*[0m:[31m17268[0m:[31m0[0m:[34m99999[0m:7:::[36;51H[K[36;51H4,1[11CTop[4;1H[34h[?25h[?25l[36;51H3[3;1H[34h[?25h[?25l[36;51H2[2;1H[34h[?25h[36;1H[K[2;1H[?25l[36;41H^[[2;1H[36;41H  [2;1H[36;51H2,0-1[9CTop[2;1H[34h[?25h[?25l[36;41H:[2;1H[36;41H[K[36;1H:[34h[?25hw[?25l[34h[?25h![?25l[34h[?25h[?25l"/etc/shadow" 52L, 1526C written[2;1H[36;51H2,0-1[9CTop[36;51H[K[36;51H2,0-1[9CTop[2;1H[34h[?25h[?25l[36;41H:[2;1H[36;1H[K[36;1H:[34h[?25hq[?25l[34h[?25h![?25l[34h[?25h[?25l[36;1H[K[36;1H[?1l>[34h[?25h[?1049l[01;32muser@root[00m:[01;34m/tmp/setuid-test[00m$ ./vi ./files [K
[?1049h[?1h=[1;36r[34l[34h[?25h[23m[24m[0m[H[J[?25l[2;1H[94m~                                                                   [3;1H~                                                                   [4;1H~                                                                   [5;1H~                                                                   [6;1H~                                                                   [7;1H~                                                                   [8;1H~                                                                   [9;1H~                                                                   [10;1H~                                                                   [11;1H~                                                                   [12;1H~                                                                   [13;1H~                                                                   [14;1H~                                                                   [15;1H~                                                                   [16;1H~                                                                   [17;1H~                                                                   [18;1H~                                                                   [19;1H~                                                                   [20;1H~                                                                   [21;1H~                                                                   [22;1H~                                                                   [23;1H~                                                                   [24;1H~                                                                   [25;1H~                                                                   [26;1H~                                                                   [27;1H~                                                                   [28;1H~                                                                   [29;1H~                                                                   [30;1H~                                                                   [31;1H~                                                                   [32;1H~                                                                   [33;1H~                                                                   [34;1H~                                                                   [35;1H~                                                                   [0m[36;51H0,0-1[9CAll[12;26HVIM - Vi IMproved[14;27Hversion 8.0.550[15;23Hby Bram Moolenaar et al.[16;7HModified by pkg-vim-maintainers@lists.alioth.debian.org[17;13HVim is open source and freely distributable[19;20HHelp poor children in Uganda![20;12Htype  :help iccf[34m<Enter>[0m       for information [22;12Htype  :q[34m<Enter>[0m               to exit         [23;12Htype  :help[34m<Enter>[0m  or  [34m<F1>[0m  for on-line help[24;12Htype  :help version8[34m<Enter>[0m   for version info[1;1H[34h[?25h[?25l[36;41H:[1;1H[36;41H[K[36;1H:[34h[?25h![?25l[34h[?25hw[?25l[34h[?25hh[?25l[34h[?25ho[?25l[34h[?25ha[?25l[34h[?25hm[?25l[34h[?25hi[?25l[34h[?25h[?25l[8C[?1l>[34h[?25h[?1049l
user

Press ENTER or type command to continue[?1049h[?1h=[?25l[1;1H[23m[24m[0m[H[J[2;1H[94m~                                                                   [3;1H~                                                                   [4;1H~                                                                   [5;1H~                                                                   [6;1H~                                                                   [7;1H~                                                                   [8;1H~                                                                   [9;1H~                                                                   [10;1H~                                                                   [11;1H~                                                                   [12;1H~                                                                   [13;1H~                                                                   [14;1H~                                                                   [15;1H~                                                                   [16;1H~                                                                   [17;1H~                                                                   [18;1H~                                                                   [19;1H~                                                                   [20;1H~                                                                   [21;1H~                                                                   [22;1H~                                                                   [23;1H~                                                                   [24;1H~                                                                   [25;1H~                                                                   [26;1H~                                                                   [27;1H~                                                                   [28;1H~                                                                   [29;1H~                                                                   [30;1H~                                                                   [31;1H~                                                                   [32;1H~                                                                   [33;1H~                                                                   [34;1H~                                                                   [35;1H~                                                                   [0m[36;51H0,0-1[9CAll[1;1H[34h[?25h[?25l[36;41H:[1;1H[36;41H[K[36;1H:[34h[?25hs[?25l[34h[?25hh[?25l[34h[?25he[?25l[34h[?25hl[?25l[34h[?25hl[?25l[34h[?25h[?25l[?1l>[34h[?25h[?1049l
bash-4.4$ whoami
user
bash-4.4$ exit
exit
[?1049h[?1h=[?25l[1;1H[23m[24m[0m[H[J[2;1H[94m~                                                                   [3;1H~                                                                   [4;1H~                                                                   [5;1H~                                                                   [6;1H~                                                                   [7;1H~                                                                   [8;1H~                                                                   [9;1H~                                                                   [10;1H~                                                                   [11;1H~                                                                   [12;1H~                                                                   [13;1H~                                                                   [14;1H~                                                                   [15;1H~                                                                   [16;1H~                                                                   [17;1H~                                                                   [18;1H~                                                                   [19;1H~                                                                   [20;1H~                                                                   [21;1H~                                                                   [22;1H~                                                                   [23;1H~                                                                   [24;1H~                                                                   [25;1H~                                                                   [26;1H~                                                                   [27;1H~                                                                   [28;1H~                                                                   [29;1H~                                                                   [30;1H~                                                                   [31;1H~                                                                   [32;1H~                                                                   [33;1H~                                                                   [34;1H~                                                                   [35;1H~                                                                   [0m[36;51H0,0-1[9CAll[1;1H[34h[?25h[?25l[36;41H:[1;1H[36;41H[K[36;1H:[34h[?25hq[?25l[34h[?25h![?25l[34h[?25h[?25l[?1l>[34h[?25h[?1049l
[01;32muser@root[00m:[01;34m/tmp/setuid-test[00m$ exit
exit
root@root:/tmp/setuid-test# nano /etc/shadow
(B)0[?1049h[1;36r[m[4l[?1h=[?1h=[?1h=[39;49m[?25l[39;49m[m[H[J[34;27H[0;7m[ Reading File ][m[34;26H[0;7m[ Read 52 lines ][m[H[0;7m  GNU nano 2.8.6            File: /etc/shadow                       [1;67H[m[34B[0;7m^G[m Get Help  [0;7m^O[m Write Out [0;7m^W[m Where Is  [0;7m^K[m Cut Text  [0;7m^J[m Justify[1B[0;7m^X[m Exit[6C[0;7m^R[m Read File [0;7m^\[m Replace   [0;7m^U[m Uncut Text[0;7m^T[m To SpellMM[34h[?25h[31A[39;49m[mroot:!:17374:0:99999:7:::[3Bdaemon:*:17268:0:99999:7:::[1Bbin:*:17268:0:99999:7:::[1Bsys:*:17268:0:99999:7:::[1Bsync:*:17268:0:99999:7:::[1Bgames:*:17268:0:99999:7:::[1Bman:*:17268:0:99999:7:::[1Blp:*:17268:0:99999:7:::[1Bmail:*:17268:0:99999:7:::[1Bnews:*:17268:0:99999:7:::[1Buucp:*:17268:0:99999:7:::[1Bproxy:*:17268:0:99999:7:::[1Bwww-data:*:17268:0:99999:7:::[1Bbackup:*:17268:0:99999:7:::[1Blist:*:17268:0:99999:7:::[1Birc:*:17268:0:99999:7:::[1Bgnats:*:17268:0:99999:7:::[1Bnobody:*:17268:0:99999:7:::[1Bsystemd-timesync:*:17268:0:99999:7:::[1Bsystemd-network:*:17268:0:99999:7:::[1Bsystemd-resolve:*:17268:0:99999:7:::[1Bsystemd-bus-proxy:*:17268:0:99999:7:::[1Bsyslog:*:17268:0:99999:7:::[1B_apt:*:17268:0:99999:7:::[1Bmessagebus:*:17268:0:99999:7:::[1Busermetrics:*:17268:0:99999:7:::[1Buuidd:*:17268:0:99999:7:::[1Brtkit:*:17268:0:99999:7:::[1Bavahi-autoipd:*:17268:0:99999:7:::[30A[1B[1BM[1B[1B[1;59H[0;7mModified[m[4;33r[33;1H
[1;36r[33;1Husbmux:*:17268:0:99999:7:::[28A[4;33r[33;1H
[1;36r[33;1Hlightdm:*:17268:0:99999:7:::[29A[30B[0;7mSave modified buffer?  (Answering "No" will DISCARD changes.)       [35;1H Y[m Yes[K[1B[0;7m N[m No  [6C   [0;7m^C[m Cancel[K[34;63H[1B[0;7m^G[m Get Help[6C[0;7mM-D[m DOS Format   [0;7mM-A[m Append[7C[0;7mM-B[m Backup File[1B[0;7m^C[m Cancel[7C [0;7mM-M[m Mac Format   [0;7mM-P[m Prepend[6C[0;7m^T[m To FilesMM[0;7mFile Name to Write: /etc/shadow                              [m[34;32H[K[1;67H[?25l[34;26H[0;7m[ Wrote 50 lines ][m[1;59H[0;7m        [m[33B[J[36;68H[36;1H[34h[?25h[?1049l[?1l>root@root:/tmp/setuid-test# exit
exit

Script done on 2018-07-27 12:30:18+0300
